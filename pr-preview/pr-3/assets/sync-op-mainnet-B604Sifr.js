import{f as n,j as e}from"./index-xNsX7Ar1.js";const o={description:"Syncing Reth with OP Mainnet and Bedrock state.",title:"Sync OP Mainnet"};function r(i){const s={a:"a",code:"code",div:"div",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",span:"span",strong:"strong",ul:"ul",...n(),...i.components};return e.jsxs(e.Fragment,{children:[e.jsx(s.header,{children:e.jsxs(s.h1,{id:"sync-op-mainnet",children:["Sync OP Mainnet",e.jsx(s.a,{"aria-hidden":"true",tabIndex:"-1",href:"#sync-op-mainnet",children:e.jsx(s.div,{"data-autolink-icon":!0})})]})}),`
`,e.jsx(s.p,{children:"To sync OP mainnet, Bedrock state needs to be imported as a starting point. There are currently two ways:"}),`
`,e.jsxs(s.ul,{children:[`
`,e.jsxs(s.li,{children:["Minimal bootstrap ",e.jsx(s.strong,{children:"(recommended)"}),": only state snapshot at Bedrock block is imported without any OVM historical data."]}),`
`,e.jsxs(s.li,{children:["Full bootstrap ",e.jsx(s.strong,{children:"(not recommended)"}),": state, blocks and receipts are imported. *Not recommended for now: ",e.jsx(s.a,{href:"https://github.com/paradigmxyz/reth/pull/11099",children:"storage consistency issue"})," tldr: sudden crash may break the node"]}),`
`]}),`
`,e.jsxs(s.h2,{id:"minimal-bootstrap-recommended",children:["Minimal bootstrap (recommended)",e.jsx(s.a,{"aria-hidden":"true",tabIndex:"-1",href:"#minimal-bootstrap-recommended",children:e.jsx(s.div,{"data-autolink-icon":!0})})]}),`
`,e.jsxs(s.p,{children:[e.jsx(s.strong,{children:"The state snapshot at Bedrock block is required."})," It can be exported from ",e.jsx(s.a,{href:"https://github.com/testinprod-io/op-erigon/blob/pcw109550/bedrock-db-migration/bedrock-migration#export-state",children:"op-geth"})," (",e.jsx(s.strong,{children:".jsonl"}),") or downloaded directly from ",e.jsx(s.a,{href:"https://mega.nz/file/GdZ1xbAT#a9cBv3AqzsTGXYgX7nZc_3fl--tcBmOAIwIA5ND6kwc",children:"here"}),"."]}),`
`,e.jsx(s.p,{children:"Import the state snapshot"}),`
`,e.jsx(e.Fragment,{children:e.jsx(s.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:e.jsx(s.code,{children:e.jsxs(s.span,{className:"line",children:[e.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#F69D50"},children:"$"}),e.jsx(s.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:" op-reth"}),e.jsx(s.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:" init-state"}),e.jsx(s.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" --without-ovm"}),e.jsx(s.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" --chain"}),e.jsx(s.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:" optimism"}),e.jsx(s.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" --datadir"}),e.jsx(s.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:" op-mainnet"}),e.jsx(s.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:" world_trie_state.jsonl"})]})})})}),`
`,e.jsx(s.p,{children:"Sync the node to a recent finalized block (e.g. 125200000) to catch up close to the tip, before pairing with op-node."}),`
`,e.jsx(e.Fragment,{children:e.jsx(s.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:e.jsx(s.code,{children:e.jsxs(s.span,{className:"line",children:[e.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#F69D50"},children:"$"}),e.jsx(s.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:" op-reth"}),e.jsx(s.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:" node"}),e.jsx(s.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" --chain"}),e.jsx(s.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:" optimism"}),e.jsx(s.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" --datadir"}),e.jsx(s.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:" op-mainnet"}),e.jsx(s.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" --debug.tip"}),e.jsx(s.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" 0x098f87b75c8b861c775984f9d5dbe7b70cbbbc30fc15adb03a5044de0144f2d0"}),e.jsx(s.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:" # block #125200000"})]})})})}),`
`,e.jsxs(s.h2,{id:"full-bootstrap-not-recommended",children:["Full bootstrap (not recommended)",e.jsx(s.a,{"aria-hidden":"true",tabIndex:"-1",href:"#full-bootstrap-not-recommended",children:e.jsx(s.div,{"data-autolink-icon":!0})})]}),`
`,e.jsxs(s.p,{children:[e.jsx(s.strong,{children:"Not recommended for now"}),": ",e.jsx(s.a,{href:"https://github.com/paradigmxyz/reth/pull/11099",children:"storage consistency issue"})," tldr: sudden crash may break the node."]}),`
`,e.jsxs(s.h3,{id:"import-state",children:["Import state",e.jsx(s.a,{"aria-hidden":"true",tabIndex:"-1",href:"#import-state",children:e.jsx(s.div,{"data-autolink-icon":!0})})]}),`
`,e.jsx(s.p,{children:`To sync OP mainnet, the Bedrock datadir needs to be imported to use as starting point.
Blocks lower than the OP mainnet Bedrock fork, are built on the OVM and cannot be executed on the EVM.
For this reason, the chain segment from genesis until Bedrock, must be manually imported to circumvent
execution in reth's sync pipeline.`}),`
`,e.jsx(s.p,{children:"Importing OP mainnet Bedrock datadir requires exported data:"}),`
`,e.jsxs(s.ul,{children:[`
`,e.jsx(s.li,{children:"Blocks [and receipts] below Bedrock"}),`
`,e.jsx(s.li,{children:"State snapshot at first Bedrock block"}),`
`]}),`
`,e.jsxs(s.h3,{id:"manual-export-steps",children:["Manual Export Steps",e.jsx(s.a,{"aria-hidden":"true",tabIndex:"-1",href:"#manual-export-steps",children:e.jsx(s.div,{"data-autolink-icon":!0})})]}),`
`,e.jsxs(s.p,{children:["The ",e.jsx(s.code,{children:"op-geth"})," Bedrock datadir can be downloaded from ",e.jsx(s.a,{href:"https://datadirs.optimism.io",children:"https://datadirs.optimism.io"}),"."]}),`
`,e.jsxs(s.p,{children:["To export the OVM chain from ",e.jsx(s.code,{children:"op-geth"}),", clone the ",e.jsx(s.code,{children:"testinprod-io/op-geth"}),` repo and checkout
`,e.jsx(s.a,{href:"https://github.com/testinprod-io/op-geth/pull/1",children:"testinprod-io/op-geth#1"}),`. Commands to export blocks, receipts and state dump can be
found in `,e.jsx(s.code,{children:"op-geth/migrate.sh"}),"."]}),`
`,e.jsxs(s.h3,{id:"manual-import-steps",children:["Manual Import Steps",e.jsx(s.a,{"aria-hidden":"true",tabIndex:"-1",href:"#manual-import-steps",children:e.jsx(s.div,{"data-autolink-icon":!0})})]}),`
`,e.jsxs(s.h4,{id:"1-import-blocks",children:["1. Import Blocks",e.jsx(s.a,{"aria-hidden":"true",tabIndex:"-1",href:"#1-import-blocks",children:e.jsx(s.div,{"data-autolink-icon":!0})})]}),`
`,e.jsxs(s.p,{children:["Imports a ",e.jsx(s.code,{children:".rlp"})," file of blocks."]}),`
`,e.jsx(s.p,{children:"Import of >100 million OVM blocks, from genesis to Bedrock, completes in 45 minutes."}),`
`,e.jsx(e.Fragment,{children:e.jsx(s.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:e.jsx(s.code,{children:e.jsxs(s.span,{className:"line",children:[e.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#F69D50"},children:"$"}),e.jsx(s.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:" op-reth"}),e.jsx(s.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:" import-op"}),e.jsx(s.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" --chain"}),e.jsx(s.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:" optimism"}),e.jsx(s.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" <"}),e.jsx(s.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:"exported-block"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"s"}),e.jsx(s.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:">"})]})})})}),`
`,e.jsxs(s.h4,{id:"2-import-receipts",children:["2. Import Receipts",e.jsx(s.a,{"aria-hidden":"true",tabIndex:"-1",href:"#2-import-receipts",children:e.jsx(s.div,{"data-autolink-icon":!0})})]}),`
`,e.jsxs(s.p,{children:[`This step is optional. To run a full node, skip this step. If however receipts are to be imported, the
corresponding transactions must already be imported (see `,e.jsx(s.a,{href:"#1-import-blocks",children:"step 1"}),")."]}),`
`,e.jsxs(s.p,{children:["Imports a ",e.jsx(s.code,{children:".rlp"}),` file of receipts, that has been exported with command specified in
`,e.jsx(s.a,{href:"https://github.com/testinprod-io/op-geth/pull/1",children:"testinprod-io/op-geth#1"})," (command for exporting receipts uses custom RLP-encoding)."]}),`
`,e.jsx(s.p,{children:"Import of >100 million OVM receipts, from genesis to Bedrock, completes in 30 minutes."}),`
`,e.jsx(e.Fragment,{children:e.jsx(s.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:e.jsx(s.code,{children:e.jsxs(s.span,{className:"line",children:[e.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#F69D50"},children:"$"}),e.jsx(s.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:" op-reth"}),e.jsx(s.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:" import-receipts-op"}),e.jsx(s.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" --chain"}),e.jsx(s.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:" optimism"}),e.jsx(s.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" <"}),e.jsx(s.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:"exported-receipt"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"s"}),e.jsx(s.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:">"})]})})})}),`
`,e.jsxs(s.h4,{id:"3-import-state",children:["3. Import State",e.jsx(s.a,{"aria-hidden":"true",tabIndex:"-1",href:"#3-import-state",children:e.jsx(s.div,{"data-autolink-icon":!0})})]}),`
`,e.jsxs(s.p,{children:["Imports a ",e.jsx(s.code,{children:".jsonl"}),` state dump. The block at which the state dump is made, must be the latest block in
reth's database. This should be block 105 235 063, the first Bedrock block (see `,e.jsx(s.a,{href:"#1-import-blocks",children:"step 1"}),")."]}),`
`,e.jsx(s.p,{children:"Import of >4 million OP mainnet accounts at Bedrock, completes in 10 minutes."}),`
`,e.jsx(e.Fragment,{children:e.jsx(s.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:e.jsx(s.code,{children:e.jsxs(s.span,{className:"line",children:[e.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#F69D50"},children:"$"}),e.jsx(s.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:" op-reth"}),e.jsx(s.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:" init-state"}),e.jsx(s.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" --chain"}),e.jsx(s.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:" optimism"}),e.jsx(s.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" <"}),e.jsx(s.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:"state-dum"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"p"}),e.jsx(s.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:">"})]})})})}),`
`,e.jsxs(s.h2,{id:"sync-from-bedrock-to-tip",children:["Sync from Bedrock to tip",e.jsx(s.a,{"aria-hidden":"true",tabIndex:"-1",href:"#sync-from-bedrock-to-tip",children:e.jsx(s.div,{"data-autolink-icon":!0})})]}),`
`,e.jsxs(s.p,{children:["Running the node with ",e.jsx(s.code,{children:"--debug.tip <block-hash>"}),`syncs the node without help from CL until a fixed tip. The
block hash can be taken from the latest block on `,e.jsx(s.a,{href:"https://optimistic.etherscan.io",children:"https://optimistic.etherscan.io"}),"."]}),`
`,e.jsxs(s.p,{children:["Use ",e.jsx(s.code,{children:"op-node"})," to track the tip. Start ",e.jsx(s.code,{children:"op-node"})," with ",e.jsx(s.code,{children:"--syncmode=execution-layer"})," and ",e.jsx(s.code,{children:"--l2.enginekind=reth"}),". If ",e.jsx(s.code,{children:"op-node"}),`'s RPC
connection to L1 is over localhost, `,e.jsx(s.code,{children:"--l1.trustrpc"})," can be set to improve performance."]})]})}function d(i={}){const{wrapper:s}={...n(),...i.components};return s?e.jsx(s,{...i,children:e.jsx(r,{...i})}):r(i)}export{d as default,o as frontmatter};
